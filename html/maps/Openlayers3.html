<!DOCTYPE HTML>
<html>
<head>
    <title>SCHAS Maps</title>
    <script src="http://www.openlayers.org/api/OpenLayers.js"></script>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>

    <link rel="stylesheet" href="//code.jquery.com/ui/1.11.2/themes/smoothness/jquery-ui.css">
    <script src="//code.jquery.com/ui/1.11.2/jquery-ui.js"></script>
    <script src="http://maps.google.com/maps/api/js?v=3&amp;sensor=false"></script>

    <script src="../js/config.prod.js"></script>
    <script src="../js/ajaxutils.js"></script>
    <script src="../js/generalutils.js"></script>
    <script src="../js/spatial1.js"></script>

    <script src="../js/useroptions.js"></script>
    <script src="Layers.js"></script>
    <script src="os.js"></script>
    <script src="citiesLayer.js"></script>
    <script src="stationsLayerVoronoi.js"></script>
    <script src="stationsLayer.js"></script>
    <script src="roadsLayer.js"></script>
    <script src="trackLayer.js"></script>
    <script src="syntheticLayer.js"></script>

    <link rel="stylesheet" type="text/css" href="SCHASstylesheet.css">

    <script>
        $(function() {
            $( "#tabs" ).tabs();
        });
        $(document).ready(function() {
            getUserOptions();
            init();
            initUserSettings();
        });

        $(window).unload(function() {
            //saveUserOptions();
        });

        function initUserSettings() { //initialize the control panel settings
            if ( !userOptions )
                userOptions = defaultUserOptions;

            runQuery1(); // load the information
            ControlPanelToggle(userOptions.controlPanel)
            trackLayerUpdate(userOptions.myUserID, false);
            setUserOptions(map);
        }
    </script>

</head>
<body>
<div id="mapdiv"></div>

<script>
    function ControlPanelToggle(onOff) {  //onOff = none, block -> if none ->opens
        d = onOff || document.getElementById('formcontent').style.display;

        if ( d == "none") {
            d = "block"
            userOptions.controlPanel = "none"
        } else {
            d = "none"
            userOptions.controlPanel = "block";
        }
        document.getElementById('formcontent').style.display = d;
    }
</script>
<div id='form'>
    <form name="input" action="javascript: submitform();" method="post">
        <div style="font-variant: small-caps; text-align: right; width: 100%; background-color: grey">
            Control Panel
            <img src="http://www.clker.com/cliparts/O/S/I/l/m/L/minus-sign-subtract-md.png"
                 width="16px" onclick="ControlPanelToggle()" /><hr/>
            <input type="button" value="Save my Options" onclick="saveUserOptions(map)"/>
            <input type="button" value="Set my Options" onclick="setUserOptions(map)"/>
            <hr/>
        </div>
        <div id="formcontent">
            <label for="query">Address/zip :</label>
            <input type="text" id="query" size=50 name="query" value="Menomonie, WI"/>

            <input type="submit" value="Submit"/>
            <br>

            <hr size="1"/>

            <div id="tabs">
                <ul>
                    <li><a href="#tabs-3">Pick/ User</a></li>
                    <li><a href="#tabs-1">Utilities</a></li>
                    <li><a href="#tabs-2">Trajectories</a></li>

                </ul>
                <div id="tabs-1">
                    <input type="button" onclick="findLocation()" value="Find my Location">
                </div>
                <div id="tabs-2">
                    <p>Find interesting trajectories - query</p>
                </div>
                <div id="tabs-3" style="height:440px;overflow-y:auto;">
                    <p>Find Users</p>
                </div>

            </div>

            <hr size="1"/>
            <a style="color: white;" href="http://www.geospaces.org">Geospaces SCHAS Maps</a> |
            <div id="coords" style="height: 1.5em; display:inline; text-align: right"></div>
        </div>
    </form>
</div>

<script>
    function clearAllMapPopups() {
        while( map.popups.length ) {
            map.removePopup(map.popups[0]);
        }
    }
    function setURL(parms) {
        s = top.window.location.href
        if (s.lastIndexOf("?") > 0) {
            s = s.substring(a, s.lastIndexOf("?"));
        }
        s= s + "?" + parms;
        top.window.location.href = s;
    }
    function changeTrackLayer(p, updateBounds ) {
        userOptions.myUserID = p;
        trackLayerUpdate(p, true);
    }
    function setUserSessions(text) {
        eval(text);
        //console.log(text);
        var cols = $rs.colnames;
        var type = $rs.coltypes;
        var data = $rs.rows || $rs[Object.keys($rs)[0]];

        str = ""
        mobile_id = "";
        for ( i in data) {
            d = data [i];
            if (mobile_id != d[0]) {
                mobile_id = d[0]
                str = str + "<hr>"
            }
            s = "setURL('mobile_id="+ d[0] + "&session_num=" + d[1] + "')";
            p = "'mobile_id="+ d[0] + "&session_num=" + d[1] + "'"; // containst mobile_id and session num
            s = "changeTrackLayer(" + p + ")";
            a = "<a href=# onclick=" + s + " >" + d[0] + "," + d[1] + "</a><br/>\n"
            str = str  + a;

            if ( i == 0) {
                CURRENT_PARMS = p;
            }
        }
        $("#tabs-3").html(str);
    }

    function runQuery1(divName) {
        url = config.PROXY + "http://www.geospaces.org/aura/webroot/db.jsp?qn=9"
        submitForm({URL: url, fdata: {}, CB: setUserSessions })
    }
</script>
</body>
</html>
